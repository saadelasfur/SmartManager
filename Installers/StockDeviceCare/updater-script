# Before: ui_print("  Hi! ");
# Now:    ui_print " Hi! "
#-----------Dynamic Installer Configs-----------#
#The #MAGISK tag is required, dont remove it
#MAGISK
setdefault magisk_support off
setdefault ensure_rw off
setdefault import_addons off
setdefault apex_mount off
setdefault extraction_speed default
setdefault permissions "0:0:0755:0644"
setdefault devices off
#-----------------------------------------------#
#Your script starts here:
#Coded by saadelasfur @telegram

ui_print " "
#Mount partitions
ui_print " -- Mounting partitions..."
mount_all

ui_print " -- Restoring Stock Device Care..."

#Delete old files
delete_recursive /system/priv-app/SmartManagerCN
delete_recursive /system/priv-app/SmartManager_v6_DeviceSecurity_CN
delete_recursive /system/priv-app/SAppLock
delete_recursive /system/priv-app/Firewall
delete /system/etc/permissions/privapp-permissions-com.samsung.android.sm_cn.xml
delete /system/etc/permissions/privapp-permissions-com.samsung.android.sm.devicesecurity.tcm_v6.xml
delete /system/etc/permissions/privapp-permissions-com.samsung.android.applock.xml
delete /system/etc/permissions/privapp-permissions-com.sec.android.app.firewall.xml

#Extract new files
package_extract_dir "packages" /system

#Set folder permissions
set_perm 0 0 0755 /system/priv-app/SmartManager_v5
set_perm 0 0 0755 /system/priv-app/SmartManager_v6_DeviceSecurity
ch_con "u:object_r:system_file:s0" /system/priv-app/SmartManager_v5
ch_con "u:object_r:system_file:s0" /system/priv-app/SmartManager_v6_DeviceSecurity

#Set apk permissions
set_perm 0 0 0644 /system/priv-app/SmartManager_v5/SmartManager_v5.apk
set_perm 0 0 0644 /system/priv-app/SmartManager_v6_DeviceSecurity/SmartManager_v6_DeviceSecurity.apk
ch_con "u:object_r:system_file:s0" /system/priv-app/SmartManager_v5/SmartManager_v5.apk
ch_con "u:object_r:system_file:s0" /system/priv-app/SmartManager_v6_DeviceSecurity/SmartManager_v6_DeviceSecurity.apk

#Set xml permissions
set_perm 0 0 0644 /system/etc/permissions/privapp-permissions-com.samsung.android.lool.xml
set_perm 0 0 0644 /system/etc/permissions/privapp-permissions-com.samsung.android.sm.devicesecurity_v6.xml
ch_con "u:object_r:system_file:s0" /system/etc/permissions/privapp-permissions-com.samsung.android.lool.xml
ch_con "u:object_r:system_file:s0" /system/etc/permissions/privapp-permissions-com.samsung.android.sm.devicesecurity_v6.xml

#Set values in floating_feature
replace "    <SEC_FLOATING_FEATURE_SMARTMANAGER_CONFIG_PACKAGE_NAME>com.samsung.android.sm_cn</SEC_FLOATING_FEATURE_SMARTMANAGER_CONFIG_PACKAGE_NAME>" "    <SEC_FLOATING_FEATURE_SMARTMANAGER_CONFIG_PACKAGE_NAME>com.samsung.android.lool</SEC_FLOATING_FEATURE_SMARTMANAGER_CONFIG_PACKAGE_NAME>" /system/etc/floating_feature.xml
replace "    <SEC_FLOATING_FEATURE_SECURITY_CONFIG_DEVICEMONITOR_PACKAGE_NAME>com.samsung.android.sm.devicesecurity.tcm</SEC_FLOATING_FEATURE_SECURITY_CONFIG_DEVICEMONITOR_PACKAGE_NAME>" "    <SEC_FLOATING_FEATURE_SECURITY_CONFIG_DEVICEMONITOR_PACKAGE_NAME>com.samsung.android.sm.devicesecurity</SEC_FLOATING_FEATURE_SECURITY_CONFIG_DEVICEMONITOR_PACKAGE_NAME>" /system/etc/floating_feature.xml
remove -a "    <SEC_FLOATING_FEATURE_COMMON_SUPPORT_NAL_PRELOADAPP_REGULATION>TRUE</SEC_FLOATING_FEATURE_COMMON_SUPPORT_NAL_PRELOADAPP_REGULATION>" /system/etc/floating_feature.xml
        
#Unmount partitions         
ui_print " -- Unmounting partitions..."
umount_all

ui_print " "
ui_print "------------------------------------------------"
ui_print " -- Restoration complete, wipe both caches!...  "
ui_print "------------------------------------------------"

ui_print " "
ui_print " -- Enjoy!!..."
ui_print " "
